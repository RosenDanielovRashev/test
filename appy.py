import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from datetime import datetime
import base64

st.set_page_config(page_title="–¢–µ—Å—Ç–æ–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –ø–µ—á–∞—Ç", layout="wide")

# CSS –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—Ä–∏–Ω—Ç–∏—Ä–∞–Ω–µ—Ç–æ
st.markdown("""
<style>
@media print {
    /* –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –±—É—Ç–æ–Ω–∏ –∏ –Ω–µ–Ω—É–∂–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç */
    .stButton, 
    button[title="View fullscreen"],
    .stDownloadButton,
    .element-container:has(button),
    .reportview-container .main footer,
    .reportview-container .main header {
        display: none !important;
    }
    
    /* –ü–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ —á–µ—Ç–ª–∏–≤–æ—Å—Ç—Ç–∞ */
    body {
        font-size: 12pt !important;
        color: black !important;
        background: white !important;
    }
    
    .main .block-container {
        padding: 10px !important;
        max-width: 100% !important;
    }
    
    /* –ö–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∏ */
    img, .stImage, .js-plotly-plot {
        max-width: 100% !important;
        height: auto !important;
        page-break-inside: avoid;
    }
    
    /* –†–∞–∑–¥–µ–ª–∏ –º–µ–∂–¥—É —Å–µ–∫—Ü–∏–∏ */
    .section {
        page-break-inside: avoid;
        margin-bottom: 20px;
    }
}
</style>
""", unsafe_allow_html=True)

st.title("üìä –¢–µ—Å—Ç–æ–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–µ—á–∞—Ç")
st.markdown("---")

# –°–µ–∫—Ü–∏—è 1: –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏
st.header("üìù –í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏")
col1, col2, col3 = st.columns(3)

with col1:
    –∏–º–µ_–ø—Ä–æ–µ–∫—Ç = st.text_input("–ò–º–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç", "–ú–æ—è—Ç —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç")
    –±—é–¥–∂–µ—Ç = st.number_input("–ë—é–¥–∂–µ—Ç (–ª–≤)", min_value=0, value=10000)

with col2:
    –Ω–∞—á–∞–ª–æ_–¥–∞—Ç–∞ = st.date_input("–ù–∞—á–∞–ª–Ω–∞ –¥–∞—Ç–∞")
    –∫—Ä–∞–π_–¥–∞—Ç–∞ = st.date_input("–ö—Ä–∞–π–Ω–∞ –¥–∞—Ç–∞")

with col3:
    –±—Ä–æ–π_–µ–ª–µ–º–µ–Ω—Ç–∏ = st.slider("–ë—Ä–æ–π –µ–ª–µ–º–µ–Ω—Ç–∏", 1, 100, 10)
    –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç = st.selectbox("–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç", ["–ù–∏—Å—ä–∫", "–°—Ä–µ–¥–µ–Ω", "–í–∏—Å–æ–∫"])

st.markdown("---")

# –°–µ–∫—Ü–∏—è 2: –ò–∑—á–∏—Å–ª–µ–Ω–∏—è
st.header("üßÆ –ò–∑—á–∏—Å–ª–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑")

# –ü—Ä–æ—Å—Ç–æ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ
if st.button("–ò–∑—á–∏—Å–ª–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏"):
    —Å—Ä–µ–¥–Ω–∞_—Å—Ç–æ–π–Ω–æ—Å—Ç = –±—é–¥–∂–µ—Ç / –±—Ä–æ–π_–µ–ª–µ–º–µ–Ω—Ç–∏
    –¥–Ω–∏_–ø—Ä–æ–µ–∫—Ç = (–∫—Ä–∞–π_–¥–∞—Ç–∞ - –Ω–∞—á–∞–ª–æ_–¥–∞—Ç–∞).days
    
    st.success(f"–°—Ä–µ–¥–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç: {—Å—Ä–µ–¥–Ω–∞_—Å—Ç–æ–π–Ω–æ—Å—Ç:.2f} –ª–≤")
    st.info(f"–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞: {–¥–Ω–∏_–ø—Ä–æ–µ–∫—Ç} –¥–Ω–∏")

# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –≥—Ä–∞—Ñ–∏–∫–∞
np.random.seed(42)
–¥–∞–Ω–Ω–∏ = pd.DataFrame({
    '–ú–µ—Å–µ—Ü': ['–Ø–Ω—É', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–Æ–Ω–∏'],
    '–ü—Ä–∏—Ö–æ–¥–∏': np.random.randint(1000, 5000, 6),
    '–†–∞–∑—Ö–æ–¥–∏': np.random.randint(500, 3000, 6)
})

–¥–∞–Ω–Ω–∏['–ü–µ—á–∞–ª–±–∞'] = –¥–∞–Ω–Ω–∏['–ü—Ä–∏—Ö–æ–¥–∏'] - –¥–∞–Ω–Ω–∏['–†–∞–∑—Ö–æ–¥–∏']

# –ì—Ä–∞—Ñ–∏–∫–∞ 1
st.subheader("–§–∏–Ω–∞–Ω—Å–æ–≤–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏")
fig1 = px.bar(–¥–∞–Ω–Ω–∏, x='–ú–µ—Å–µ—Ü', y=['–ü—Ä–∏—Ö–æ–¥–∏', '–†–∞–∑—Ö–æ–¥–∏'], 
              title="–ü—Ä–∏—Ö–æ–¥–∏ –∏ —Ä–∞–∑—Ö–æ–¥–∏ –ø–æ –º–µ—Å–µ—Ü–∏",
              barmode='group')
st.plotly_chart(fig1, use_container_width=True)

# –ì—Ä–∞—Ñ–∏–∫–∞ 2
st.subheader("–ü–µ—á–∞–ª–±–∞ –ø–æ –º–µ—Å–µ—Ü–∏")
fig2 = px.line(–¥–∞–Ω–Ω–∏, x='–ú–µ—Å–µ—Ü', y='–ü–µ—á–∞–ª–±–∞', 
               title="–ü–µ—á–∞–ª–±–∞ –ø–æ –º–µ—Å–µ—Ü–∏", markers=True)
fig2.add_hline(y=0, line_dash="dash", line_color="red")
st.plotly_chart(fig2, use_container_width=True)

st.markdown("---")

# –°–µ–∫—Ü–∏—è 3: –ö–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
st.header("üñºÔ∏è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏")

# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å matplotlib
import matplotlib.pyplot as plt

col1, col2 = st.columns(2)

with col1:
    st.subheader("–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω–∏")
    # –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ –∑–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    data_dist = np.random.normal(100, 15, 1000)
    
    fig_dist, ax = plt.subplots(figsize=(8, 4))
    ax.hist(data_dist, bins=30, alpha=0.7, color='skyblue', edgecolor='black')
    ax.set_xlabel('–°—Ç–æ–π–Ω–æ—Å—Ç–∏')
    ax.set_ylabel('–ß–µ—Å—Ç–æ—Ç–∞')
    ax.set_title('–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ')
    ax.grid(True, alpha=0.3)
    st.pyplot(fig_dist)

with col2:
    st.subheader("–ö—Ä—ä–≥–æ–≤–∞ –¥–∏–∞–≥—Ä–∞–º–∞")
    –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ = ['–ö–∞—Ç–µ–≥–æ—Ä–∏—è A', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è B', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è C', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è D']
    —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ = [35, 25, 20, 20]
    
    fig_pie, ax = plt.subplots(figsize=(8, 4))
    ax.pie(—Å—Ç–æ–π–Ω–æ—Å—Ç–∏, labels=–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, autopct='%1.1f%%', startangle=90)
    ax.set_title('–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')
    st.pyplot(fig_pie)

st.markdown("---")

# –°–µ–∫—Ü–∏—è 4: –¢–∞–±–ª–∏—Ü–∏
st.header("üìã –¢–∞–±–ª–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏")

# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞
table_data = pd.DataFrame({
    'ID': range(1, 11),
    '–ò–º–µ –Ω–∞ –∑–∞–¥–∞—á–∞': [f'–ó–∞–¥–∞—á–∞ {i}' for i in range(1, 11)],
    '–°—Ç–∞—Ç—É—Å': np.random.choice(['–ó–∞–≤—ä—Ä—à–µ–Ω–∞', '–í –ø—Ä–æ–≥—Ä–µ—Å', '–ß–∞–∫–∞—â–∞'], 10),
    '–ü—Ä–æ–≥—Ä–µ—Å %': np.random.randint(0, 101, 10),
    '–û—Ç–≥–æ–≤–æ—Ä–µ–Ω': np.random.choice(['–ò–≤–∞–Ω', '–ú–∞—Ä–∏—è', '–ü–µ—Ç—ä—Ä', '–ê–Ω–Ω–∞'], 10)
})

st.dataframe(table_data, use_container_width=True)

# –û–±–æ–±—â–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
st.subheader("–û–±–æ–±—â–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric("–û–±—â –±—Ä–æ–π –∑–∞–¥–∞—á–∏", len(table_data))
with col2:
    st.metric("–ó–∞–≤—ä—Ä—à–µ–Ω–∏", len(table_data[table_data['–°—Ç–∞—Ç—É—Å'] == '–ó–∞–≤—ä—Ä—à–µ–Ω–∞']))
with col3:
    st.metric("–°—Ä–µ–¥–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å", f"{table_data['–ü—Ä–æ–≥—Ä–µ—Å %'].mean():.1f}%")
with col4:
    st.metric("–ú–∞–∫—Å–∏–º–∞–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å", f"{table_data['–ü—Ä–æ–≥—Ä–µ—Å %'].max()}%")

st.markdown("---")

# –°–µ–∫—Ü–∏—è 5: –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
st.header("üìÑ –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")

tab1, tab2, tab3 = st.tabs(["–û–ø–∏—Å–∞–Ω–∏–µ", "–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è", "–†–µ–∑—É–ª—Ç–∞—Ç–∏"])

with tab1:
    st.write("""
    ### –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞
    
    –¢–æ–≤–∞ –µ —Ç–µ—Å—Ç–æ–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç—Ç–∞ –∑–∞ –ø–µ—á–∞—Ç.
    –°—ä–¥—ä—Ä–∂–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –≤–∏–¥–æ–≤–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è.
    
    **–û—Å–Ω–æ–≤–Ω–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
    - –§–∏–Ω–∞–Ω—Å–æ–≤–∏ –≥—Ä–∞—Ñ–∏–∫–∏
    - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑
    - –¢–∞–±–ª–∏—á–Ω–∏ –¥–∞–Ω–Ω–∏
    - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
    """)

with tab2:
    st.write("""
    ### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –Ω–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è
    
    –ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ —Å–∞ —Å–ª–µ–¥–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É–ª–∏ –∏ –º–µ—Ç–æ–¥–∏:
    
    1. **–°—Ä–µ–¥–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç:**
    ```
    –°—Ä–µ–¥–Ω–∞_—Å—Ç–æ–π–Ω–æ—Å—Ç = –ë—é–¥–∂–µ—Ç / –ë—Ä–æ–π_–µ–ª–µ–º–µ–Ω—Ç–∏
    ```
    
    2. **–ü–µ—á–∞–ª–±–∞:**
    ```
    –ü–µ—á–∞–ª–±–∞ = –ü—Ä–∏—Ö–æ–¥–∏ - –†–∞–∑—Ö–æ–¥–∏
    ```
    
    3. **–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç:**
    ```
    –î–Ω–∏ = –ö—Ä–∞–π–Ω–∞_–¥–∞—Ç–∞ - –ù–∞—á–∞–ª–Ω–∞_–¥–∞—Ç–∞
    ```
    """)

with tab3:
    st.write("""
    ### –ö–ª—é—á–æ–≤–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
    
    –ù–∞ –±–∞–∑–∞—Ç–∞ –Ω–∞ –≤—ä–≤–µ–¥–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏ –∏ –∏–∑–≤—ä—Ä—à–µ–Ω–∏—Ç–µ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è:
    
    - üìà **–§–∏–Ω–∞–Ω—Å–æ–≤–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:** –ü–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–∞ —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è
    - ‚è±Ô∏è **–í—Ä–µ–º–µ–≤–∏ —Ä–∞–º–∫–∏:** –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∏ —Å—Ä–æ–∫–æ–≤–µ
    - üéØ **–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç:** –í–∏—Å–æ–∫–∞ —Å—Ç–µ–ø–µ–Ω –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
    
    **–ü—Ä–µ–ø–æ—Ä—ä–∫–∏:**
    - –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–∏—Ç–µ —Ç–µ–º–ø–æ–≤–µ
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑—Ö–æ–¥–∏—Ç–µ
    - –£–≤–µ–ª–∏—á–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç—Ç–∞
    """)

st.markdown("---")

# –°–µ–∫—Ü–∏—è 6: –ë—É—Ç–æ–Ω –∑–∞ –ø–µ—á–∞—Ç
st.header("üñ®Ô∏è –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç—á–µ—Ç")

st.markdown("""
### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ –ø–µ—á–∞—Ç:

1. –ö–ª–∏–∫–Ω–µ—Ç–µ –±—É—Ç–æ–Ω–∞ –ø–æ-–¥–æ–ª—É
2. –í –¥–∏–∞–ª–æ–≥–æ–≤–∏—è –ø—Ä–æ–∑–æ—Ä–µ—Ü –∑–∞ –ø–µ—á–∞—Ç –∏–∑–±–µ—Ä–µ—Ç–µ **"–ó–∞–ø–∞–∑–∏ –∫–∞—Ç–æ PDF"**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞ –Ω–∞ **"–ü–æ—Ä—Ç—Ä–µ—Ç"** –∑–∞ –Ω–∞–π-–¥–æ–±—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
4. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ç–∞ **"–§–æ–Ω–æ–≤–∏ –≥—Ä–∞—Ñ–∏–∫–∏"** –∑–∞ –≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–µ—Ç–µ
5. –ö–ª–∏–∫–Ω–µ—Ç–µ **"–ó–∞–ø–∞–∑–∏"**

**–°—ä–≤–µ—Ç:** –ó–∞ –Ω–∞–π-–¥–æ–±—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Google Chrome.
""")

col1, col2, col3 = st.columns([1, 2, 1])

with col2:
    if st.button("üñ®Ô∏è –ü—Ä–∏–Ω—Ç–∏—Ä–∞–π —Ç–æ–∑–∏ –æ—Ç—á–µ—Ç", use_container_width=True, type="primary"):
        # JavaScript –∫–æ–¥ –∑–∞ –∑–∞–¥–µ–π—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø–µ—á–∞—Ç–∞
        js_code = """
        <script>
        setTimeout(function() {
            window.print();
        }, 500);
        </script>
        """
        st.components.v1.html(js_code, height=0)
        
        st.success("‚úÖ –î–∏–∞–ª–æ–≥—ä—Ç –∑–∞ –ø–µ—á–∞—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –æ—Ç–≤–æ—Ä–∏! –ò–∑–±–µ—Ä–µ—Ç–µ '–ó–∞–ø–∞–∑–∏ –∫–∞—Ç–æ PDF'.")

# –î–æ–ª–µ–Ω –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª
st.markdown("---")
st.markdown(
    f"<div style='text-align: center; color: #666; font-size: 0.8em;'>"
    f"–û—Ç—á–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω –Ω–∞: {datetime.now().strftime('%Y-%m-%d %H:%M')} | "
    f"–¢–µ—Å—Ç–æ–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–µ—á–∞—Ç"
    f"</div>", 
    unsafe_allow_html=True
)
